# Logging AnalyticsでOCI Audit Logsを管理・分析してみよう！ (所要時間：20分程度)


## 問題
セキュリティインシデントや意図しないリソースの削除などに備え、OCI Audit Logsのログ管理および分析を実施する必要があります。
下記要件を実現できるダッシュボードの作成およびアラートの設定を実施してください。

### ダッシュボード要件
1. 異常なログが発生しているかどうか確認できる（クラスタ分析）
2. 削除されたリソースを確認できる（円グラフ）
    - 実行されたActionの内訳（create、update、Deleteなど）はフィールドのActionTyoeから確認できます。
    - 削除されたリソースはフィールドのEventから確認できます。
4. 異常な場所からログインが実施されていないことを確認できる (マップ)
5. ユーザ毎のログイン成功を確認できる (ヒストグラム付きレコード)
6. ユーザ毎のログイン失敗を確認できる (ヒストグラム付きレコード)

![クラスタ分析と円グラフ](images/LA-Audit/LA-Audit2.png "クラスタ分析と円グラフ")
![ログインの失敗と成功](images/LA-Audit/LA-Audit3.png "ログインの失敗と成功")

### アラート要件
1. ログイン失敗が発生したらアラートをメールアドレスに通知する
2. Object Storageのバケットが削除されたらメールアドレスに通知する

## 解答
まず要件を満たすダッシュボードを作成します。
ダッシュボードはログ・アナリティクス→ダッシュボード→ダッシュボードの作成をクリックします。
![ダッシュボードの作成](images/LA-Audit/LA-Audit4.png "ダッシュボードの作成")

ダッシュボードに任意の名前を入力し、作成をクリックします。
![ダッシュボードの作成](images/LA-Audit/LA-Audit5.png "ダッシュボードの作成")

作成したダッシュボードに要件を追加します。
ログ・エクスプローラの画面から、OCI AUdit Logを選択します。
![ダッシュボードの作成](images/LA-Audit/LA-Audit6.png "ダッシュボードの作成")

### ダッシュボード要件
1. 異常なログが発生しているかどうか確認できる（クラスタ分析）<br>
   クラスタ分析はビジュアライゼーションメニューからクラスタ分析を選択します。
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit7.png "ダッシュボードの作成")
   クラスタ分析の結果が表示されるので、作成したダッシュボードにクラスタ分析の結果を追加します。<br>
   アクション→名前を付けて保存をクリックします。
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit8.png "ダッシュボードの作成")
   
   以下の項目を設定し、「保存」をクリックするとダッシュボードにクラスタ分析の結果が追加されます。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
    
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit9.png)
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit14.png)
   

3. 削除されたリソースを確認できる（円グラフ）<br>
   ログ・エクスプローラから、フィールドのAction Typeからdeleteをチェックを入れて
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit10.png)
   
   グループ化基準にEventをドラック&ドロップします。
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit11.png)
   
   削除されたリソースが表示されるので、作成したダッシュボードに追加します。<br>
   アクション→名前を付けて保存をクリックするとダッシュボードに追加されます。
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit13.png)
   
   要件1と同様に以下の項目を設定し、「保存」をクリックします。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit12.png)
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit15.png)

   
   

5. 異常な場所からログインが実施されていないことを確認できる (マップ)

6. ユーザ毎のログイン成功を確認できる (ヒストグラム付きレコード)

7. ユーザ毎のログイン失敗を確認できる (ヒストグラム付きレコード)

### アラート要件
1. ログイン失敗が発生したらアラートをメールアドレスに通知する
2. Object Storageのバケットが削除されたらメールアドレスに通知する
