# Logging AnalyticsでOCI Audit Logsを管理・分析してみよう！ (所要時間：20分程度)


## 問題
アプリケーションを構築しているOCI環境のセキュリティインシデントや意図しないリソースの削除などに備え、OCI Audit Logsのログ管理および分析を実施する必要があります。
下記要件を実現できるダッシュボードの作成およびアラートの設定を実施してください。

### ダッシュボード要件
1. 異常なログが発生しているかどうか確認できる（クラスタ分析）
2. 削除されたリソースを確認できる（円グラフ）
    - 実行されたActionの内訳（create、update、Deleteなど）はフィールドの「ActionType」を利用します。
    - 削除されたリソースはフィールドの「Event」を利用します。
4. 異常な場所からログインが実施されていないことを確認できる (マップ)<br>
    - 成功したログイン（sso.session.create.success）はフィールドの「IAM EventID」を利用します。
6. ユーザ毎のログイン成功を確認できる (ヒストグラム付きレコード)<br>
    - 成功したログイン（sso.session.create.success）はフィールドの「IAM EventID」を利用します。
8. ユーザ毎のログイン失敗を確認できる (ヒストグラム付きレコード)<br>
     - 失敗したログイン（sso.session.create.failure）はフィールドの「IAM EventID」を利用します。

![ダッシュボードの作成](images/LA-Audit/LA-Audit29.png "ダッシュボードの作成")

### アラート要件
1. ログイン失敗が発生したらアラートをメールアドレスに通知する
2. Object Storageのバケットが削除されたらメールアドレスに通知する

## 解答
まず要件を満たすダッシュボードを作成します。
ダッシュボードは「ログ・アナリティクス」→「ダッシュボード」→「ダッシュボードの作成」をクリックします。

![ダッシュボードの作成](images/LA-Audit/LA-Audit4.png "ダッシュボードの作成")

ダッシュボードに「任意の名前」を入力し、「作成」をクリックします。

![ダッシュボードの作成](images/LA-Audit/LA-Audit5.png "ダッシュボードの作成")

作成したダッシュボードに要件を追加します。
ログ・エクスプローラの画面から、「OCI AUdit Log」を選択します。

![ダッシュボードの作成](images/LA-Audit/LA-Audit6.png "ダッシュボードの作成")

### ダッシュボード要件
1. 異常なログが発生しているかどうか確認できる（クラスタ分析）<br>
   ビジュアライゼーションメニューから「クラスタ分析」を選択します。
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit7.png "ダッシュボードの作成")
   クラスタ分析の結果が表示されるので、作成したダッシュボードにクラスタ分析の結果を追加します。<br>
   アクション→名前を付けて保存をクリックします。
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit8.png "ダッシュボードの作成")
   
   以下の項目を設定し、「保存」をクリックするとダッシュボードにクラスタ分析の結果が追加されます。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
    
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit9.png)
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit14.png)
   

3. 削除されたリソースを確認できる（円グラフ）<br>
   ログ・エクスプローラから、フィールドの「Action」から「delete」をクリックして適用をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit10.png)
   
   グループ化基準にEventをドラック&ドロップします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit11.png)

   ビジュアライゼーションメニューか「円グラフ」を選択します。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit30.png)
   
   要件を満たした結果が表示されるので、、作成したダッシュボードに追加します。<br>
   「アクション」→「名前を付けて保存」をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit13.png)
   
   要件1と同様に以下の項目を設定し、「保存」をクリックするとダッシュボードに追加されます。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit12.png)
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit15.png)

5. 異常な場所からログインが実施されていないことを確認できる (マップ)<br>
   フィールドの「IAM EventID」から「sso.session.create.success」にチェックを入れて適用をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit16.png)
   
   ビジュアライゼーションメニューからマップを選択します。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit17.png)

   要件を満たした結果が表示されるので、作成したダッシュボードに追加します。<br>
   「アクション」→「名前を付けて保存」をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit18.png)
   
   要件1と同様に以下の項目を設定し、「保存」をクリックするとダッシュボードに追加されます。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
    
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit19.png)
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit20.png)
   
   

7. ユーザ毎のログイン成功を確認できる (ヒストグラム付きレコード)<br>
   フィールドの「IAM EventID」から「sso.session.create.success」にチェックを入れて適用をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit16.png)
   
   グループ化基準に「User Name」をドラック&ドロップします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit21.png)

   要件を満たした結果が表示されるので、、作成したダッシュボードに追加します。<br>
   「アクション」→「名前を付けて保存」をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit24.png)
   
   要件1と同様に以下の項目を設定し、「保存」をクリックするとダッシュボードに追加されます。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
    
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit22.png)
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit23.png)

9. ユーザ毎のログイン失敗を確認できる (ヒストグラム付きレコード)
   フィールドの「IAM EventID」から「sso.session.create.success」にチェックを入れて適用をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit25.png)
   
   グループ化基準に「User Name」をドラック&ドロップします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit26.png)

   要件を満たした結果が表示されるので、、作成したダッシュボードに追加します。<br>
   アクション→名前を付けて保存をクリックします。
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit27.png)
   
   要件1と同様に以下の項目を設定し、「保存」をクリックするとダッシュボードに追加されます。
    - 検索名：任意の検索名
    - ダッシュボードに追加
    - 既存のダッシュボードに追加
    - ダッシュボード：作成したダッシュボードを選択
    
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit28.png)
   
   ![ダッシュボードの作成](images/LA-Audit/LA-Audit29.png)

### アラート要件
1. ログイン失敗が発生したらアラートをメールアドレスに通知する
   
2. リソースが削除されたらメールアドレスに通知する

